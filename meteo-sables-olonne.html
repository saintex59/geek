<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√©t√©o Les Sables-d'Olonne</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ocean: #0a2a4a;
    --deep: #071828;
    --wave: #0e5c8a;
    --foam: #b8e0f7;
    --sky: #87ceeb;
    --accent: #00d4ff;
    --danger: #ff6b35;
    --text: #e8f4fd;
    --muted: #7aaec8;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--deep);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }
  body::before {
    content: '';
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 40%;
    background: linear-gradient(180deg, transparent 0%, rgba(10,42,74,0.6) 40%, var(--ocean) 100%);
    pointer-events: none;
    z-index: 0;
  }
  .waves {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 120px;
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
  }
  .wave {
    position: absolute;
    bottom: 0;
    width: 200%;
    height: 80px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 80'%3E%3Cpath fill='%230e5c8a' fill-opacity='0.4' d='M0,40 C360,80 720,0 1080,40 C1260,60 1380,20 1440,40 L1440,80 L0,80 Z'/%3E%3C/svg%3E") repeat-x bottom;
    background-size: 720px 80px;
    animation: wave 8s linear infinite;
  }
  .wave:nth-child(2) {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 80'%3E%3Cpath fill='%230a2a4a' fill-opacity='0.6' d='M0,60 C240,20 480,80 720,50 C960,20 1200,70 1440,40 L1440,80 L0,80 Z'/%3E%3C/svg%3E");
    animation: wave 12s linear infinite reverse;
    opacity: 0.7;
  }
  @keyframes wave { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }

  .container {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 20px 16px 140px;
  }
  .header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    margin-bottom: 28px;
    flex-wrap: wrap;
    gap: 8px;
  }
  .city-name {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(38px, 8vw, 64px);
    letter-spacing: 2px;
    color: var(--accent);
    text-shadow: 0 0 40px rgba(0,212,255,0.3);
    line-height: 1;
  }
  .city-sub {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .update-time {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    text-align: right;
  }
  .update-time span { color: var(--accent); }
  .demo-badge {
    display: inline-block;
    background: rgba(255,107,53,0.15);
    border: 1px solid rgba(255,107,53,0.4);
    border-radius: 20px;
    padding: 3px 10px;
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--danger);
    letter-spacing: 1px;
    margin-top: 4px;
  }
  .main-card {
    background: linear-gradient(135deg, rgba(14,92,138,0.3) 0%, rgba(10,42,74,0.5) 100%);
    border: 1px solid rgba(0,212,255,0.15);
    border-radius: 20px;
    padding: 28px;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 24px;
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
  }
  .main-card::before {
    content: '';
    position: absolute;
    top: -50%; right: -20%;
    width: 300px; height: 300px;
    background: radial-gradient(circle, rgba(0,212,255,0.08) 0%, transparent 70%);
    pointer-events: none;
  }
  .main-temp {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(72px, 15vw, 110px);
    line-height: 1;
  }
  .main-temp sup { font-size: 0.35em; vertical-align: super; color: var(--muted); }
  .main-info { flex: 1; }
  .weather-desc { font-size: 20px; font-weight: 500; color: var(--foam); margin-bottom: 8px; }
  .feels-like { font-family: 'DM Mono', monospace; font-size: 12px; color: var(--muted); margin-bottom: 4px; }
  .humidity-main { font-family: 'DM Mono', monospace; font-size: 13px; color: var(--sky); }
  .weather-icon { font-size: 56px; filter: drop-shadow(0 0 20px rgba(0,212,255,0.4)); }

  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }
  @media(min-width:600px){ .grid{ grid-template-columns: repeat(3,1fr); } }

  .card {
    background: rgba(10,42,74,0.5);
    border: 1px solid rgba(0,212,255,0.1);
    border-radius: 16px;
    padding: 18px 16px;
    backdrop-filter: blur(8px);
    transition: border-color .3s, transform .2s;
  }
  .card:hover { border-color: rgba(0,212,255,0.3); transform: translateY(-2px); }
  .card-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .dot { width:5px;height:5px;border-radius:50%;background:var(--accent);display:inline-block; }
  .card-value { font-family:'Bebas Neue',sans-serif;font-size:38px;line-height:1; }
  .card-unit { font-family:'DM Mono',monospace;font-size:12px;color:var(--muted);margin-top:4px; }
  .card-sub { font-size:12px;color:var(--foam);margin-top:6px; }
  .wind-dir {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    color: var(--accent);
    margin-top: 4px;
  }
  .compass {
    width:28px;height:28px;
    border:1.5px solid rgba(0,212,255,0.4);
    border-radius:50%;
    display:inline-flex;
    align-items:center;
    justify-content:center;
  }
  .cloud-badge {
    display:inline-block;
    background:rgba(0,212,255,0.1);
    border:1px solid rgba(0,212,255,0.25);
    border-radius:20px;
    padding:3px 10px;
    font-family:'DM Mono',monospace;
    font-size:11px;
    color:var(--accent);
    margin-top:6px;
  }
  .bft-bar { display:flex;gap:2px;margin-top:6px; }
  .bft-seg { flex:1;height:4px;border-radius:2px;background:rgba(255,255,255,0.07); }
  .bft-seg.active { background:var(--accent); }
  .bft-seg.warn { background:var(--danger); }

  .tides-section {
    background:rgba(10,42,74,0.5);
    border:1px solid rgba(0,212,255,0.1);
    border-radius:20px;
    padding:24px;
    backdrop-filter:blur(8px);
  }
  .section-title {
    font-family:'Bebas Neue',sans-serif;
    font-size:22px;
    letter-spacing:2px;
    color:var(--accent);
    margin-bottom:18px;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .tides-grid { display:grid;grid-template-columns:repeat(2,1fr);gap:12px; }
  @media(min-width:500px){ .tides-grid{ grid-template-columns:repeat(4,1fr); } }
  .tide-item { text-align:center;padding:14px 10px;border-radius:12px; }
  .tide-item.high {
    background:linear-gradient(180deg,rgba(0,212,255,0.12) 0%,rgba(0,212,255,0.04) 100%);
    border:1px solid rgba(0,212,255,0.25);
  }
  .tide-item.low {
    background:linear-gradient(180deg,rgba(184,224,247,0.06) 0%,transparent 100%);
    border:1px solid rgba(184,224,247,0.12);
  }
  .tide-type { font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:6px; }
  .tide-time { font-family:'Bebas Neue',sans-serif;font-size:32px;line-height:1; }
  .tide-height { font-family:'DM Mono',monospace;font-size:12px;margin-top:4px; }
  .tide-item.high .tide-height { color:var(--accent); }
  .tide-item.low .tide-height { color:var(--muted); }
  .tide-progress-wrap { margin-top:18px; }
  .tide-progress-label {
    font-family:'DM Mono',monospace;
    font-size:11px;
    color:var(--muted);
    margin-bottom:6px;
    display:flex;
    justify-content:space-between;
  }
  .tide-bar { height:6px;background:rgba(255,255,255,0.06);border-radius:10px;overflow:hidden; }
  .tide-fill { height:100%;background:linear-gradient(90deg,var(--wave),var(--accent));border-radius:10px;transition:width 1.5s ease; }

  .loading {
    text-align:center;
    padding:60px 20px;
    font-family:'DM Mono',monospace;
    color:var(--muted);
    font-size:13px;
    letter-spacing:2px;
  }
  .loading::after {
    content:'';
    display:block;
    width:40px;height:40px;
    border:2px solid rgba(0,212,255,0.2);
    border-top-color:var(--accent);
    border-radius:50%;
    margin:20px auto 0;
    animation:spin 1s linear infinite;
  }
  @keyframes spin { to{transform:rotate(360deg)} }

  @media(max-width:400px){
    .main-card{flex-direction:column;text-align:center;}
  }
</style>
</head>
<body>
<div class="waves"><div class="wave"></div><div class="wave"></div></div>
<div class="container">
  <div class="header">
    <div>
      <div class="city-sub">‚óè M√©t√©o Marine</div>
      <div class="city-name">Les Sables-d'Olonne</div>
    </div>
    <div>
      <div class="update-time" id="updateTime">Chargement‚Ä¶</div>
      <div id="demoBadge"></div>
    </div>
  </div>
  <div id="appContent"><div class="loading">CHARGEMENT DES DONN√âES</div></div>
</div>

<script>
const LAT = 46.4965, LON = -1.7832;

/* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ */
function wmoToDesc(c){
  const m={0:['Ciel d√©gag√©','‚òÄÔ∏è'],1:['Peu nuageux','üå§Ô∏è'],2:['Partiellement nuageux','‚õÖ'],3:['Couvert','‚òÅÔ∏è'],
    45:['Brouillard','üå´Ô∏è'],48:['Brouillard givrant','üå´Ô∏è'],51:['Bruine l√©g√®re','üå¶Ô∏è'],53:['Bruine','üå¶Ô∏è'],
    55:['Bruine forte','üå¶Ô∏è'],61:['Pluie l√©g√®re','üåßÔ∏è'],63:['Pluie','üåßÔ∏è'],65:['Pluie forte','üåßÔ∏è'],
    71:['Neige l√©g√®re','üå®Ô∏è'],80:['Averses','üå¶Ô∏è'],81:['Averses','üåßÔ∏è'],82:['Averses fortes','‚õàÔ∏è'],
    95:['Orage','‚õàÔ∏è'],99:['Orage violent','‚õàÔ∏è']};
  return m[c]||['Variable','üå°Ô∏è'];
}
function cloudType(l,m,h,cv){
  if(cv<15)return'Ciel d√©gag√©';
  if(l>60)return'Stratus / Nimbostratus';
  if(l>30)return'Cumulus';
  if(m>50)return'Altocumulus';
  if(m>20)return'Altostratus';
  if(h>50)return'Cirrostratus';
  if(h>20)return'Cirrus';
  return'Cumulo-fractus';
}
function cloudCeil(l,m,h){
  if(l>30){const f=Math.max(500,Math.round(2500-l*15));return{label:f<1000?f+' ft ‚ö†':f+' ft',note:'Bas'};}
  if(m>30)return{label:Math.round(6000-m*20)+' ft',note:'Moyen'};
  if(h>30)return{label:'18 000 ft',note:'Haut'};
  return{label:'CAVOK',note:'D√©gag√©'};
}
function beaufort(k){return k<1?0:k<4?1:k<7?2:k<11?3:k<17?4:k<22?5:k<28?6:k<34?7:k<41?8:k<48?9:k<56?10:k<64?11:12;}
function windLabel(d){return['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSO','SO','OSO','O','ONO','NO','NNO'][Math.round(d/22.5)%16];}
function fmt(d){return d.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});}

/* ‚îÄ‚îÄ Mar√©es (calcul astronomique) ‚îÄ‚îÄ */
function computeTides(){
  const now=new Date();
  const knownNM=new Date('2000-01-06T18:14:00Z');
  const lun=29.530588861;
  const days=(now-knownNM)/86400000;
  const phase=(days%lun)/lun;
  const coeff=Math.round(50+45*Math.abs(Math.cos(phase*2*Math.PI)));
  const T=12*3600+25*60;
  const haut=+(1.4+(coeff/120)*3.8).toFixed(2);
  const bas=+(haut-(coeff/105)*4.5).toFixed(2);
  const offset=(days%1)*T;
  const tides=[];
  for(let i=0;i<5;i++){
    const t=new Date(now);t.setHours(0,0,0,0);
    t.setSeconds(Math.round((i*T/2+(offset%T))%86400));
    tides.push({time:t,type:i%2===0?'PM':'BM',height:i%2===0?haut:bas});
  }
  tides.sort((a,b)=>a.time-b.time);
  return{tides:tides.slice(0,4),coeff};
}

/* ‚îÄ‚îÄ Donn√©es de d√©mo (fallback) ‚îÄ‚îÄ */
function demoWeather(){
  const h=new Date().getHours();
  return{
    current:{
      temperature_2m:h>=7&&h<20?14:11,
      apparent_temperature:h>=7&&h<20?12:9,
      relative_humidity_2m:78,
      weather_code:2,
      cloud_cover:45,
      wind_speed_10m:12,
      wind_gusts_10m:19,
      wind_direction_10m:285
    },
    hourly:{cloud_cover_low:[20],cloud_cover_mid:[40],cloud_cover_high:[15]},
    _demo:true
  };
}

/* ‚îÄ‚îÄ Fetch m√©t√©o avec fallback ‚îÄ‚îÄ */
async function fetchWeather(){
  const url=`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}`
    +`&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,cloud_cover,wind_speed_10m,wind_gusts_10m,wind_direction_10m`
    +`&hourly=cloud_cover_low,cloud_cover_mid,cloud_cover_high`
    +`&forecast_days=1&wind_speed_unit=kn&timezone=Europe%2FParis`;
  try{
    const ctrl=new AbortController();
    setTimeout(()=>ctrl.abort(),8000);
    const r=await fetch(url,{signal:ctrl.signal});
    if(!r.ok)throw new Error();
    return await r.json();
  }catch(e){
    console.warn('API indisponible ‚Äì donn√©es de d√©mo utilis√©es');
    return demoWeather();
  }
}

/* ‚îÄ‚îÄ Rendu ‚îÄ‚îÄ */
function render(wx,td){
  const c=wx.current,h=wx.hourly,demo=!!wx._demo;
  const [desc,emoji]=wmoToDesc(c.weather_code);
  const bft=beaufort(c.wind_speed_10m),bftG=beaufort(c.wind_gusts_10m);
  const low=h.cloud_cover_low[0]??0,mid=h.cloud_cover_mid[0]??0,hi=h.cloud_cover_high[0]??0;
  const cType=cloudType(low,mid,hi,c.cloud_cover);
  const ceil=cloudCeil(low,mid,hi);
  const dir=windLabel(c.wind_direction_10m);
  const now=new Date();
  const{tides,coeff}=td;
  const next=tides.find(t=>t.time>now);
  const prev=next?tides[tides.indexOf(next)-1]:null;
  const prog=(next&&prev)?Math.min(99,Math.round(((now-prev.time)/(next.time-prev.time))*100)):50;
  const mont=next&&next.type==='PM';

  document.getElementById('updateTime').innerHTML=`M√ÄJ <span>${fmt(now)}</span>`;
  document.getElementById('demoBadge').innerHTML=demo?'<div class="demo-badge">‚ö† MODE D√âMO ‚Äî v√©rifiez votre connexion</div>':'';

  const bbar=n=>Array.from({length:12},(_,i)=>`<div class="bft-seg ${i<n?(n>=7?'warn':'active'):''}"></div>`).join('');
  const tidesHtml=tides.map(t=>`
    <div class="tide-item ${t.type==='PM'?'high':'low'}">
      <div class="tide-type">${t.type==='PM'?'üîº Pleine mer':'üîΩ Basse mer'}</div>
      <div class="tide-time">${fmt(t.time)}</div>
      <div class="tide-height">${t.height.toFixed(2)} m</div>
    </div>`).join('');

  document.getElementById('appContent').innerHTML=`
    <div class="main-card">
      <div class="main-temp">${Math.round(c.temperature_2m)}<sup>¬∞C</sup></div>
      <div class="main-info">
        <div class="weather-desc">${desc}</div>
        <div class="feels-like">Ressenti ${Math.round(c.apparent_temperature)}¬∞C</div>
        <div class="humidity-main">üíß Humidit√© ${c.relative_humidity_2m}%</div>
      </div>
      <div class="weather-icon">${emoji}</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="card-label"><span class="dot"></span>Vent √©tabli</div>
        <div class="card-value">${Math.round(c.wind_speed_10m)}</div>
        <div class="card-unit">n≈ìuds</div>
        <div class="bft-bar">${bbar(bft)}</div>
        <div class="wind-dir">
          <div class="compass"><span style="display:inline-block;transform:rotate(${c.wind_direction_10m}deg);font-size:13px">‚Üë</span></div>
          ${dir} ‚Äî Bf ${bft}
        </div>
      </div>

      <div class="card">
        <div class="card-label"><span class="dot"></span>Rafales</div>
        <div class="card-value" style="color:${bftG>=7?'var(--danger)':'var(--text)'}">${Math.round(c.wind_gusts_10m)}</div>
        <div class="card-unit">n≈ìuds</div>
        <div class="bft-bar">${bbar(bftG)}</div>
        <div class="card-sub">${Math.round(c.wind_gusts_10m*1.852)} km/h max</div>
      </div>

      <div class="card">
        <div class="card-label"><span class="dot"></span>Humidit√©</div>
        <div class="card-value">${c.relative_humidity_2m}</div>
        <div class="card-unit">%</div>
        <div style="height:4px;background:rgba(255,255,255,0.07);border-radius:4px;overflow:hidden;margin-top:10px">
          <div style="height:100%;width:${c.relative_humidity_2m}%;background:linear-gradient(90deg,var(--wave),var(--sky));border-radius:4px;transition:width 1.5s"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-label"><span class="dot"></span>Nuages</div>
        <div class="card-value">${c.cloud_cover}</div>
        <div class="card-unit">% couverture</div>
        <div class="cloud-badge">${cType}</div>
      </div>

      <div class="card">
        <div class="card-label"><span class="dot"></span>Plafond</div>
        <div class="card-value" style="font-size:clamp(22px,5vw,32px);padding-top:4px">${ceil.label}</div>
        <div class="card-unit">${ceil.note}</div>
        <div class="card-sub" style="color:var(--muted);font-size:11px;margin-top:6px;font-family:'DM Mono',monospace">‚Üì${low}% ¬∑ ‚ü∑${mid}% ¬∑ ‚Üë${hi}%</div>
      </div>

      <div class="card">
        <div class="card-label"><span class="dot"></span>Coefficient</div>
        <div class="card-value" style="color:${coeff>80?'var(--danger)':coeff>60?'var(--sky)':'var(--text)'}">${coeff}</div>
        <div class="card-unit">mar√©e</div>
        <div class="card-sub">${mont?'‚¨Ü Montante':'‚¨á Descendante'}</div>
      </div>
    </div>

    <div class="tides-section">
      <div class="section-title">
        üåä Mar√©es du jour
        <span style="font-family:'DM Mono',monospace;font-size:12px;color:var(--muted);font-weight:normal;margin-left:auto">
          Coeff. <span style="color:var(--accent)">${coeff}</span>
        </span>
      </div>
      <div class="tides-grid">${tidesHtml}</div>
      <div class="tide-progress-wrap">
        <div class="tide-progress-label">
          <span>${mont?'‚¨Ö Basse mer':'‚¨Ö Pleine mer'}</span>
          <span>${mont?'‚Üë Montante':'‚Üì Descendante'} ¬∑ ${prog}%</span>
          <span>${mont?'Pleine mer ‚û°':'Basse mer ‚û°'}</span>
        </div>
        <div class="tide-bar"><div class="tide-fill" style="width:${prog}%"></div></div>
      </div>
    </div>`;
}

/* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
async function init(){
  try{
    const[wx,td]=await Promise.all([fetchWeather(),Promise.resolve(computeTides())]);
    render(wx,td);
  }catch(e){
    console.error(e);
    render(demoWeather(),computeTides());
  }
}
init();
setInterval(init,10*60*1000);
</script>
</body>
</html>
